<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloudi Ultra MVP</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:20px; background:#f0f2f5; color:#333;}
h1,h2 {text-align:center;}
.container {max-width:1200px; margin:auto;}
input, select, button {padding:5px; margin:5px;}
#progressBar {width:100%; background:#ddd; height:25px; border-radius:5px; margin-bottom:10px;}
#progress {height:100%; background:#4caf50; width:0%; border-radius:5px;}
.node {width:40px; height:40px; display:inline-block; margin:3px; text-align:center; line-height:40px; color:#fff; border-radius:5px;}
.idle {background:#777;}
.busy {background:#2196F3;}
.done {background:#4caf50;}
#log {background:#000; color:#0f0; padding:10px; height:200px; overflow:auto;}
</style>
</head>
<body>
<div class="container">
<h1>Cloudi Ultra MVP</h1>
<div>
<label id="labelLang">Language: </label>
<select id="langSelect">
<option value="en">English</option>
<option value="ru">Русский</option>
</select>
</div>

<div id="settings">
<label id="labelOps">Operations:</label><input type="number" id="opsInput" value="500000000">
<label id="labelNodeCapacity">Node Capacity:</label><input type="number" id="nodeCapacity" value="200000">
<label id="labelNodesPerDC">Nodes per DC:</label><input type="number" id="nodesPerDC" value="4">
<label id="labelAiPct">AI Optimization %:</label><input type="number" id="aiPct" value="10">
<label id="labelMarkup">Markup %:</label><input type="number" id="markup" value="20">
<button onclick="startDemo()" id="startBtn">Start Demo</button>
</div>

<h2>Progress</h2>
<div id="progressBar"><div id="progress"></div></div>
<div id="dcContainer"></div>

<h2>Log</h2>
<pre id="log"></pre>

<h2>Graphs</h2>
<canvas id="costChart" width="400" height="200"></canvas>
<canvas id="timeChart" width="400" height="200"></canvas>
</div>

<script>
// Translations
const texts = {
en:{
Ops:"Operations", NodeCapacity:"Node Capacity", NodesPerDC:"Nodes per DC", AiPct:"AI Optimization %", Markup:"Markup %", StartDemo:"Start Demo"
},
ru:{
Ops:"Операции", NodeCapacity:"Ёмкость ноды", NodesPerDC:"Нод/ДЦ", AiPct:"AI Оптимизация %", Markup:"Наценка %", StartDemo:"Старт"
}
};

document.getElementById('langSelect').addEventListener('change',()=>{
const lang=document.getElementById('langSelect').value;
document.getElementById('labelOps').textContent=texts[lang].Ops+":";
document.getElementById('labelNodeCapacity').textContent=texts[lang].NodeCapacity+":";
document.getElementById('labelNodesPerDC').textContent=texts[lang].NodesPerDC+":";
document.getElementById('labelAiPct').textContent=texts[lang].AiPct+":";
document.getElementById('labelMarkup').textContent=texts[lang].Markup+":";
document.getElementById('startBtn').textContent=texts[lang].StartDemo;
});

function log(msg){ let l=document.getElementById('log'); l.textContent+=msg+"\n"; l.scrollTop=l.scrollHeight;}

// Cloudi classes
class AI_Dispatcher{
constructor(nodes, ops){ this.nodes=nodes; this.ops=ops; }
dispatchStep(){ log(`AI Dispatcher: distributing ${this.ops} operations across ${this.nodes} nodes.`);}
}

class SmartPacking{
constructor(ops, nodeCapacity, aiPct){ this.ops=ops; this.nodeCapacity=nodeCapacity; this.aiPct=aiPct; }
computeEffective(){ return this.nodeCapacity*(1+this.aiPct/100);}
}

class ElasticScale{
constructor(nodesPerDC, cloudiNodes){ this.nodesPerDC=nodesPerDC; this.cloudiNodes=cloudiNodes;}
getDCs(){ return Math.ceil(this.cloudiNodes/this.nodesPerDC);}
}

class CostOptimizer{
constructor(infraMonth, effectiveCapacity, cloudiNodes, markup, ops){
this.infraMonth=infraMonth; this.effectiveCapacity=effectiveCapacity; this.cloudiNodes=cloudiNodes; this.markup=markup; this.ops=ops;
}
compute(){
let costPerOp=this.infraMonth/(this.effectiveCapacity*this.cloudiNodes*30*24*3600);
let pricePerOp=costPerOp*(1+this.markup/100);
let total=this.ops*pricePerOp;
return {costPerOp, pricePerOp, total};
}
}

// Demo runner
function startDemo(){
document.getElementById('log').textContent="";
const ops=Number(document.getElementById('opsInput').value);
const nodeCapacity=Number(document.getElementById('nodeCapacity').value);
const nodesPerDC=Number(document.getElementById('nodesPerDC').value);
const aiPct=Number(document.getElementById('aiPct').value);
const markup=Number(document.getElementById('markup').value);
const infraMonth=100;

let rawNodes=Math.ceil(ops/nodeCapacity);
let sp=new SmartPacking(ops,nodeCapacity,aiPct);
let effectiveCapacity=sp.computeEffective();
let cloudiNodes=Math.ceil(ops/effectiveCapacity);
let es=new ElasticScale(nodesPerDC, cloudiNodes);
let dcs=es.getDCs();
let estTime=ops/(effectiveCapacity*cloudiNodes);

log(`Baseline Test: ${ops} ops`);
log(`Raw Nodes: ${rawNodes}`);
log(`Effective Node Capacity: ${effectiveCapacity.toFixed(2)}`);
log(`Cloudi Nodes: ${cloudiNodes}`);
log(`DCs Needed: ${dcs}`);
log(`Estimated Time (s): ${estTime.toFixed(2)}`);
log(`Infra/Month ($): ${infraMonth}`);

let co=new CostOptimizer(infraMonth,effectiveCapacity,cloudiNodes,markup,ops);
let {costPerOp, pricePerOp, total}=co.compute();
log(`Cost per op ($): ${costPerOp.toExponential(3)}`);
log(`Price per op ($): ${pricePerOp.toExponential(3)}`);
log(`Total Price ($): ${total.toFixed(2)}`);

const dcContainer=document.getElementById('dcContainer');
dcContainer.innerHTML="";
for(let i=0;i<dcs;i++){
let div=document.createElement('div');
div.innerHTML=`<b>DC ${i+1}</b><br>`;
for(let j=0;j<nodesPerDC;j++){
let nodeDiv=document.createElement('div');
nodeDiv.className='node idle';
nodeDiv.textContent='N';
div.appendChild(nodeDiv);
}
dcContainer.appendChild(div);
}

// Animation
let processed=0; let totalOps=ops;
let progressBar=document.getElementById('progress');
let nodes=document.querySelectorAll('.node');
function step(){
processed+=totalOps/(cloudiNodes*20);
let pct=Math.min(processed/totalOps*100,100);
progressBar.style.width=pct+"%";
nodes.forEach((n,i)=>{ if(Math.random()<pct/100){ n.className='node busy';} if(pct>99){n.className='node done';}});
if(pct<100) requestAnimationFrame(step);
else{ log("Demo Complete!"); updateCharts(total, estTime);}
}
requestAnimationFrame(step);

function updateCharts(totalPrice, estTime){
const ctx1=document.getElementById('costChart').getContext('2d');
const ctx2=document.getElementById('timeChart').getContext('2d');
const chart1=new Chart(ctx1,{type:'bar',data:{labels:['Cloudi','AWS','GCP','Azure'], datasets:[{label:'Cost $', data:[totalPrice, totalPrice*1.3, totalPrice*1.4, totalPrice*1.5], backgroundColor:['#2196F3','#FF5722','#FFC107','#9C27B0']}]}, options:{responsive:true}});
const chart2=new Chart(ctx2,{type:'bar',data:{labels:['Cloudi','AWS','GCP','Azure'], datasets:[{label:'Time s', data:[estTime, estTime*1.2, estTime*1.5, estTime*1.7], backgroundColor:['#4CAF50','#FF5722','#FFC107','#9C27B0']}]}, options:{responsive:true}});
}
}
</script>
</body>
</html>