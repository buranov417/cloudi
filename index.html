<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OpenEntrop</title>
    <style>
        :root { --accent: #00ff41; --bg: #000; --card: #111; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, system-ui, sans-serif; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .container { width: 90%; max-width: 420px; background: var(--card); border-radius: 35px; padding: 30px; box-shadow: 0 25px 50px rgba(0,0,0,0.8); border: 1px solid #222; }
        h1 { text-align: center; font-weight: 800; letter-spacing: -1px; font-size: 2.2rem; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #555; font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 30px; }
        
        .section { background: #1a1a1a; border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid #282828; }
        .label { font-size: 0.65rem; color: var(--accent); font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        
        .btn { background: #fff; color: #000; border: none; padding: 18px; width: 100%; border-radius: 15px; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 0.9rem; }
        .btn:active { transform: scale(0.97); opacity: 0.8; }
        .btn-secondary { background: var(--accent); color: #000; margin-top: 10px; display: none; }
        
        #previewArea { display: none; background: #000; border: 1px solid #333; border-radius: 12px; padding: 15px; margin-top: 15px; font-family: monospace; font-size: 0.75rem; color: #00ff41; max-height: 100px; overflow-y: auto; }
        input[type="file"] { display: none; }
        .info { font-size: 0.7rem; color: #666; margin-top: 8px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1>OpenEntrop</h1>
    <div class="subtitle">Next-Gen Data Protocol</div>

    <div class="section">
        <div class="label">Сжатие данных</div>
        <input type="file" id="compressInput">
        <button class="btn" onclick="document.getElementById('compressInput').click()">ВЫБРАТЬ И СЖАТЬ</button>
        <button id="exportBrn" class="btn btn-secondary">ИМПОРТИРОВАТЬ .BRN</button>
    </div>

    <div class="section">
        <div class="label">Работа с .brn</div>
        <input type="file" id="decompressInput" accept=".brn">
        <button class="btn" style="background: #222; color: #fff;" onclick="document.getElementById('decompressInput').click()">ОТКРЫТЬ .BRN</button>
        
        <div id="previewArea"></div>
        
        <button id="viewBtn" class="btn btn-secondary" style="background: #333; color: #fff;">ПРОСМОТР БЕЗ РАЗЖАТИЯ</button>
        <button id="exportOriginal" class="btn btn-secondary">ВОССТАНОВИТЬ И ЭКСПОРТ</button>
    </div>

    <div class="info" id="globalStatus">СИСТЕМА ГОТОВА</div>
</div>

<script>
    let brnBlob = null;
    let originalBlob = null;
    let originalName = "";

    // --- ЛОГИКА СЖАТИЯ ---
    document.getElementById('compressInput').onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        document.getElementById('globalStatus').innerText = "ПРОТОКОЛ ЗАПУЩЕН...";
        await new Promise(r => setTimeout(r, 1500)); // Магия вычислений

        // ТВОЯ ФОРМУЛА: Здесь создается тот самый файл 49 байт
        const content = new TextEncoder().encode("OPENENTROP_DATA_BLOCK_" + btoa(file.name));
        brnBlob = new File([content.slice(0, 49)], file.name + ".brn", { type: "application/octet-stream" });
        
        document.getElementById('globalStatus').innerText = "ФАЙЛ СЖАТ ДО 49 БАЙТ";
        document.getElementById('exportBrn').style.display = "block";
    };

    // --- ЛОГИКА ОТКРЫТИЯ .BRN ---
    document.getElementById('decompressInput').onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        originalName = file.name.replace(".brn", "");
        document.getElementById('globalStatus').innerText = "ОБЪЕКТ .BRN ОБНАРУЖЕН";
        document.getElementById('viewBtn').style.display = "block";
        document.getElementById('exportOriginal').style.display = "block";
    };

    // --- ПРОСМОТР БЕЗ РАЗЖАТИЯ (СЕНСАЦИЯ) ---
    document.getElementById('viewBtn').onclick = function() {
        const preview = document.getElementById('previewArea');
        preview.style.display = "block";
        preview.innerHTML = "> ЧТЕНИЕ ВНУТРИ СЖАТОЙ ЭНТРОПИИ...<br>> СТРУКТУРА СОХРАНЕНА<br>> [ВИРТУАЛЬНАЯ ПРОЕКЦИЯ ДАННЫХ]";
        document.getElementById('globalStatus').innerText = "ПРОСМОТР АКТИВИРОВАН";
    };

    // --- ФУНКЦИЯ ЭКСПОРТА (МЕНЮ АЙФОНА) ---
    async function shareFile(fileObj) {
        if (navigator.share) {
            try {
                await navigator.share({
                    files: [fileObj],
                    title: 'OpenEntrop',
                    text: 'Processed via OpenEntrop Protocol'
                });
            } catch (err) { console.log("Share canceled"); }
        } else {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(fileObj);
            link.download = fileObj.name;
            link.click();
        }
    }

    document.getElementById('exportBrn').onclick = () => shareFile(brnBlob);
    
    document.getElementById('exportOriginal').onclick = async () => {
        document.getElementById('globalStatus').innerText = "РЕКОНСТРУКЦИЯ...";
        await new Promise(r => setTimeout(r, 2000));
        
        // Здесь имитация восстановления 15МБ обратно
        const recovered = new Blob(["ВОССТАНОВЛЕННЫЙ КОНТЕНТ"], { type: "application/octet-stream" });
        const finalFile = new File([recovered], originalName, { type: "application/octet-stream" });
        
        shareFile(finalFile);
        document.getElementById('globalStatus').innerText = "ФАЙЛ ВОССТАНОВЛЕН";
    };
</script>

</body>
</html>
